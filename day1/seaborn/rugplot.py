import seaborn as sns
import koreanize_matplotlib # 한글 폰트 설정을 위한 라이브러리입니다. matplotlib에서 한글이 깨지는 문제를 해결해줍니다.
import matplotlib.pyplot as plt

#그래프 상세 설명
#빨간색 실선 (regplot 결과): 데이터의 전체적인 흐름을 선형 회귀로 분석하여 자동으로 그려준 것입니다. 
# 선 주변의 옅은 그림자는 '신뢰구간'으로, 데이터가 얼마나 이 선에 밀집되어 있는지를 보여줍니다.
#축의 작은 선들 (rugplot 결과):
#X축 바닥: 연도별로 데이터가 얼마나 고르게 분포하는지 보여줍니다. 
#          (여기서는 매년 12개월치 데이터가 꼬박꼬박 있으니 일정한 간격으로 찍힙니다.)
#Y축 왼쪽: 승객 수의 분포를 보여줍니다. 
#          낮은 수치(100~200)에는 선들이 빽빽하고, 
#          높은 수치(500 이상)에는 선들이 듬성듬성한 것을 확인할 수 있습니다.
#
#1. 분포 확인의 3가지 핵심 요소데이터의 분포를 본다는 것은 크게 
# 다음 세 가지 질문에 답을 찾는 과정입니다.
# ① 중심 경향 (Center)
# 질문: 데이터가 평균적으로 어디에 몰려 있는가?
# 확인: kdeplot의 가장 높은 봉우리나 histplot의 가장 긴 막대를 통해 확인합니다.
# 의미: "항공 승객 수는 보통 200~300명 수준이 가장 많구나"라는 사실을 알 수 있습니다.
# 
# ② 퍼짐 정도 (Spread/Variance)
# 질문: 데이터가 좁게 모여 있는가, 넓게 퍼져 있는가?
# 확인: 그래프의 폭(Width)을 봅니다.
# 의미: 폭이 좁으면 "매달 승객 수가 일정하다"는 뜻이고, 
#       폭이 넓으면 "성수기와 비성수기의 차이가 매우 크다"는 뜻입니다.
# 
# ③ 모양과 비대칭성 (Shape & Skewness)
# 질문: 좌우 대칭인가, 아니면 한쪽으로 치우쳤는가?
# 확인: 꼬리가 어느 쪽으로 길게 늘어졌는지 봅니다.
# 의미: 오른쪽으로 꼬리가 길다면(Positive Skew), 
#       평소보다 압도적으로 승객이 많았던 '특별한 달'들이 존재한다는 것을 암시합니다.
# 
# 2. 왜 시계열에서 rugplot()으로 분포 확인하는 이유 
# rugplot()은 데이터 하나하나를 선으로 표시하기 때문에 **'밀도'**를 가장 정직하게 보여줍니다.
# 선이 빽빽한 곳: 데이터가 자주 발생하는 구간입니다. (예: 1949~1950년대의 평범한 일상)
# 선이 듬성듬성한 # 곳: 데이터가 드물게 발생하는 구간입니다. (예: 1960년대의 폭발적인 성수기 기록)
#
# 3. 실례: flights 데이터 분석 상황 
# 분석 대상    | 분포 확인의 결과 (해석)
# X축(연도)    | 1949년부터 1960년까지 균일한 분포를 보임 
#              | (데이터가 누락 없이 매달 잘 수집됨).
# Y축(승객 수) | 100~300명 구간에 밀도(Rug)가 매우 높음. 
#              | (대부분의 기간 동안 승객은 이 범위에 있었음).
# 상단 구간    | 500~600명 구간은 밀도가 낮음. 
#              | (최근 연도의 특정 성수기에만 나타나는 드문 현상임).
#
# 분포를 알면 무엇이 좋은가요?
# 이상치 발견: 분포에서 혼자 멀리 떨어져 있는 
#              'Rug' 선을 보고 데이터 오류나 특이 현상을 찾습니다.
# 의사결정: "가장 밀도가 높은 구간(가장 빈번한 승객 수)"을 
#           기준으로 비행기 배차나 예산을 짤 수 있습니다.
#예측의 정확도: 데이터가 한곳에 예쁘게 모여 있을수록(분포가 안정적일수록)
#               우리가 만든 추세선(빨간 선)의 예측은 더 정확해집니다.

# 1. 데이터 로드
flights = sns.load_dataset("flights")

# 2. 그래프 그리기
plt.figure(figsize=(12, 7))

# (1) 산점도와 추세선 한 번에 그리기 (regplot)
# line_kws는 선의 스타일을, scatter_kws는 점의 스타일을 조절합니다.
sns.regplot(
    data=flights, 
    x="year", 
    y="passengers", 
    scatter=True, 
    line_kws={"color": "red", "lw": 3}, # 추세선을 빨간색으로
    label="탑승객 증가 추세선"
)

# (2) 축 위에 데이터 밀도 표시 (rugplot)
# x축(연도별 데이터 밀도)과 y축(승객 수별 데이터 밀도) 모두 표시 가능합니다.
sns.rugplot(
    data=flights, 
    x="year", 
    y="passengers", 
    height=0.03, 
    color="darkblue", 
    alpha=0.5
)

# 3. 그래프 꾸미기
plt.title("항공 탑승객 변화 추이: 추세선(Reg)과 데이터 위치(Rug)")
plt.xlabel("연도 (Year)")
plt.ylabel("탑승객 수 (Passengers)")
plt.legend()
plt.grid(True, linestyle='--', alpha=0.5)
plt.show()